---
import { NAV_LINKS, SITE_NAME } from "../consts";
import { IMAGES } from "../images";

const pathname = Astro.url.pathname.replace(/\/$/, "") || "/";
const isActive = (href: string) => {
  const normalized = href.replace(/\/$/, "") || "/";
  return pathname === normalized;
};
---

<header class="sticky top-0 z-50 border-b border-border/70 bg-bg/70 backdrop-blur">
  <div class="mx-auto flex max-w-6xl items-center justify-between py-3 container-px">
    <a href="/" class="flex items-center gap-3 no-underline">
      <img
        src={IMAGES.brand.logo}
        alt={SITE_NAME}
        width="160"
        height="42"
        class="h-8 w-auto"
        loading="eager"
        decoding="async"
      />
      <span class="sr-only">{SITE_NAME}</span>
    </a>

    <nav class="hidden items-center gap-7 md:flex">
      {NAV_LINKS.map((l) => (
        <a
          href={l.href}
          aria-current={isActive(l.href) ? "page" : undefined}
          class:list={[
            "rounded-full px-3 py-1.5 text-sm font-medium no-underline transition",
            isActive(l.href)
              ? "bg-brand/10 text-fg ring-1 ring-brand/20"
              : "text-muted hover:bg-bg hover:text-fg",
          ]}
        >
          {l.label}
        </a>
      ))}
    </nav>

    <details class="group relative md:hidden">
      <summary
        class="list-none rounded-xl border border-border bg-card px-3 py-2 text-sm font-medium text-fg shadow-sm transition hover:bg-bg"
      >
        <span class="inline-flex items-center gap-2">
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="opacity-80"
            aria-hidden="true"
          >
            <path
              d="M4 7H20M4 12H20M4 17H20"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
          Menu
        </span>
      </summary>

      <div
        class="absolute right-0 mt-2 w-[min(18rem,calc(100vw-2rem))] overflow-hidden rounded-2xl border border-border bg-card shadow-soft"
      >
        <div class="flex flex-col p-2">
          {NAV_LINKS.map((l) => (
            <a
              href={l.href}
              aria-current={isActive(l.href) ? "page" : undefined}
              class:list={[
                "rounded-xl px-3 py-2 text-sm font-medium no-underline transition",
                isActive(l.href)
                  ? "bg-brand/10 text-fg ring-1 ring-brand/20"
                  : "text-muted hover:bg-bg hover:text-fg",
              ]}
            >
              {l.label}
            </a>
          ))}
        </div>
      </div>
    </details>
  </div>
</header>

