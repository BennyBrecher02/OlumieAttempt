---
import type { CollectionEntry } from "astro:content";
import Badge from "./Badge.astro";

export type Props = {
  entry: CollectionEntry<"updates">;
};

const { entry } = Astro.props as Props;
const href = `/updates/${entry.slug}`;
const tags = (entry.data.tags ?? []).map((t) => t.trim()).filter(Boolean);
const tagAttr = tags.join("|");
const streamLabel = entry.data.type === "insight" ? "Insight" : "Firm update";
---

<a
  href={href}
  data-tags={tagAttr}
  data-type={entry.data.type}
  data-series={entry.data.series ?? ""}
  class="surface block h-full p-6 no-underline transition hover:-translate-y-0.5 hover:shadow-soft"
>
  <p class="text-xs font-semibold uppercase tracking-wider text-muted">
    {streamLabel}{entry.data.series ? ` â€¢ ${entry.data.series}` : ""}
  </p>
  <div class="flex items-start justify-between gap-4">
    <h3 class="text-base font-semibold tracking-tight">{entry.data.title}</h3>
    <time class="shrink-0 text-xs text-muted" datetime={entry.data.pubDate.toISOString()}>
      {entry.data.pubDate.toLocaleDateString("en-US", { year: "numeric", month: "short", day: "2-digit" })}
    </time>
  </div>
  <p class="mt-2 text-sm leading-relaxed text-muted">{entry.data.description}</p>
  {tags.length ? (
    <div class="mt-4 flex flex-wrap gap-2">
      {tags.slice(0, 3).map((t) => (
        <Badge>{t}</Badge>
      ))}
    </div>
  ) : null}
</a>

